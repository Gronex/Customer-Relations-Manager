<h1 ng-if="vm.editing">Editing  {{vm.user.name}}</h1>
<h1 ng-if="!vm.editing">Creating new user</h1>

<form ng-submit="vm.save()">
  <div class="row">
    <div class="form-group col-sm-6">
      <label>First Name</label>
      <input class="form-control" type="text" ng-model="vm.user.firstName">
    </div>
    <div class="form-group col-sm-6">
      <label>Last Name</label>
      <input class="form-control" type="text" ng-model="vm.user.lastName">
    </div>
  </div>
  <div class="form-group">
    <label>Email</label>
    <input class="form-control" ng-disabled="vm.editing" type="text" ng-model="vm.user.email">
  </div>
  <div class="form-group">
    <label>Role</label>
    <select class="form-control" ng-model="vm.user.role" material-select>
      <option ng-repeat="role in vm.roles">{{role}}</option>
    </select>
  </div>

  <button class="btn btn-primary" type="submit">Save <i class="fa fa-floppy-o"></i></button>
  <a ui-sref="Users" class="btn btn-primary">Back <i class="fa fa-arrow-left"></i></a>
  <button ng-if="vm.editing" class="btn btn-danger pull-right" type="button" ng-click="vm.remove()">
    Remove <i class="fa fa-trash"></i>
  </button>
</form>

<hr>

<div input-field>
  <input
  typeahead-on-select="vm.onGroupSelect($item)"
  type="text"
  ng-model="vm.group"
  uib-typeahead="group.name for group in vm.groups | filter:$viewValue | limitTo:8"
  class="form-control">
  <label>Add groups</label>
</div>

<ul class="collection">
  <li class="collection-item dismissable" ng-repeat="group in vm.user.groups">
    <button class="btn waves-effect wave-light btn-flat" type="button" ng-click="vm.removeGroup(group)">
      <i class="material-icons left">remove_group</i>
    </button>{{group.name}}
  </li>
</ul>

<button ng-disabled="!vm.editing" class="waves-effect waves-light btn modal-trigger" modal href="#goalModal">User goals</button>

<div id="goalModal" class="modal">
  <div class="modal-content">
    <h2>Goals for {{vm.user.name}}</h2>
    <p class="red-text text-darken-2" ng-if="vm.goal.errMsg">
      {{vm.goal.errMsg}}
    </p>
    <form class="col s12">
      <div class="row">
        <div input-field class="col s2">
          <input type="number" ng-minlength="4" min="2000" ng-model="vm.goal.year">
          <label>Year</label>
        </div>
        <div input-field class="col s1">
          <input type="number" max="12" ng-minlength="1" min="1" ng-model="vm.goal.month">
          <label>Month</label>
        </div>
        <div input-field class="col s4">
          <input min="0" type="number" ng-model="vm.goal.goal">
          <label>Goal</label>
        </div>
        <button ng-click="vm.addGoal()" type="submit" class="btn-floating btn-large waves-effect waves-light green"><i class="material-icons">add</i></button>
      </div>
    </form>
    <table>
      <thead>
        <tr>
          <td>Year</td>
          <td>Month</td>
          <td>Goal</td>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="goal in vm.goals">
          <td>
            {{goal.year}}
          </td>
          <td>
            {{goal.month}}
          </td>
          <td>
            {{goal.goal}}
          </td>
          <td>
            <button
              class="btn-floating btn-small waves-effect waves-light red"
              ng-click="vm.removeGoal(goal)">
              <i class="material-icons">remove</i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <button class="btn modal-action modal-close waves-effect waves-green">Close</button>
  </div>
</div>
